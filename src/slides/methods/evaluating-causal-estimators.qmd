---
title: "Evaluating Causal Estimators"
subtitle: "SUBTITLE"
author: Vladislav Morozov  
format:
  revealjs:
    include-in-header: 
      text: |
        <meta name="description" content="Learn how to evaluate  (lecture note slides)"/> 
    width: 1150
    slide-number: true
    sc-sb-title: true
    incremental: true   
    logo: ../../themes/favicon.ico
    footer: "Evaluating Causal Estimators"
    footer-logo-link: "https://vladislav-morozov.github.io/simulations-course/"
    theme: ../../themes/slides_theme.scss
    toc: TRUE
    toc-depth: 2
    toc-title: Contents
    transition: convex
    transition-speed: fast
slide-level: 4
title-slide-attributes:
    data-background-color: "#3c165cff"
    data-footer: " "
filters:
  - reveal-header 
embed-resources: true
include-in-header: ../../themes/mathjax.html 
highlight-style: tango
open-graph:
    description: "Learn how to evaluate c (lecture note slides)" 
---






## Introduction {background="#00100F"}
  

### Lecture Info {background="#43464B"}

#### Learning Outcomes

This lecture is about evaluating causal estimators

<br>

By the end, you should be able to

 
- Describe k 
- Use simulations as a tool for constructing (counter)examples
 


#### References 
  
::: {.nonincremental}

Intros to causal inference:

- @Cunningham2021CausalInferenceMixtape (more basic)
- @Morgan2014CounterfactualsCausalInference (more general with many discussions)

On fixed effect estimation:

- [My slides](https://vladislav-morozov.github.io/econometrics-2/slides/panel/fe.html) 
- Chapter 17 in @Hansen2022Econometrics

:::
 


## Motivation: Fixed Effects and Simulations as Counterexamples {background="#00100F"}
 


### Background on Fixed Effect Estimation {background="#43464B"}

#### Setting: Panel Data

Suppose that we have data on

- Some outcome $Y_{it}$
- Some treatment $\bX_{it}$ (possibly vector)

. . . 

::: {.left-color}

Interested in causal effect of $\bX_{it}$  on $Y_{it}$

:::

<br>


Data is <span class="highlight">panel</span>: 

- Two dimensions ($i$ and $t$)
- E.g. units $i=1, \dots, N$ over time $t=1, \dots, T$



#### Reminder: Random Intercept/Fixed Effect Estimation

::: {.left-color}

One way to estimate effects of treatment on $Y_{it}$ is using <span class="highlight">random intercept/fixed effect</span> estimators

:::

Simple example: one-way FE estimator:

1. Construct
$$\small 
\tilde{Y}_{it} = Y_{it} - \dfrac{1}{T}\sum_{s=1}^T Y_{is}, \quad \tilde{\bX}_{it} = \bX_{it} - \dfrac{1}{T}\sum_{s=1}^T \bX_{is},
$$

2. The one-way FE estimator is the  OLS estimator in regression of $\tilde{Y}_{it}$ on $\tilde{\bX}_{it}$



#### Causal Model Underlying FE


::: {.left-color}

Remember: properties of causal estimator only meaningful if one specifies an underlying causal model

:::

. . .  

For one-way FE estimator: typical setting is linear <span class="highlight">potential outcomes</span> model

$$
Y_{it}^{\bx} = \alpha_i + \bbeta'\bx + U_{it}
$$ {#eq-fe-causal-model}

- $\alpha_i$ --- the "random intercept"/unit FE
- $\beta$ --- common treatment effect of $x$ 
 
#### Properties Under Random Intercept Model

::: {.rounded-box}

Under


- FE causal model ([-@eq-fe-causal-model])
- Strict exogeneity: $\E[U_{it}|X_{i1}, \dots, X_{iT}]=0$
 

the one-way random intercept estimator $\hat{\bbeta}^{FE}$ satisfies
$$
\begin{aligned}
 \E[\hat{\bbeta}^{FE}]  & = \bbeta, \\
 \sqrt{N}(\hat{\bbeta}^{FE} - \bbeta) & \xrightarrow{d} N(0, \avar(\hat{\bbeta}^{FE}))
\end{aligned}
$$


:::


### Fixed Effect Estimators and Heterogeneous Coefficients  {background="#43464B"}

#### Discussion of FE Estimator

- Typical motivation: "controlling unobserved heterogeneity"
- Unobserved heterogeneity:
    - Unit-specific effects $\alpha_i$
    - Can also time effects $\gamma_t$ and other versions

::: {.left-color}

If model correctly specified, suitable FE estimator will recover $\bbeta$

::: 

#### A More Realistic Causal Model
 
But model ([-@eq-fe-causal-model]) not internally consistent:

::: {.nonincremental}

- Why unobserved heterogeneity only in intercepts $\alpha_i$?
- Why not <span class="highlight">heterogeneous treatment effects</span>?

:::

. . . 

More realistic to assume causal model
$$
Y_{it}^{\bx} = \alpha_i + \bbeta_{i}'\bx + U_{it}
$$ {#eq-causal-hetero}
Now $\bbeta_i$ --- also unit-specific

::: {.footer}

Can also consider even more general models with $\bbeta_{it}$

:::

#### Question: What Does the FE Estimator Do?

Suppose model ([-@eq-causal-hetero]) is true, but we still apply $\hat{\bbeta}^{FE}$

::: {.left-color}

What is $\hat{\bbeta}^{FE}$ actually estimating?

:::

<br>

- Important to separate estimator from underlying causal model!
- Can carry out FE estimation even if true model is not random intercept
 
#### Estimand of FE Estimator Under Model  ([-@eq-causal-hetero])

Can show that
$$ \small
\hat{\bbeta}^{FE} \xrightarrow \E\left[ \left( \E\left[ \tilde{\bX}_i'\tilde{\bX}_i \right]\right)^{-1} \tilde{\bX}'_i\bbeta_i \right]
$$
where $\tilde{\bX}_i'$ --- matrix with $\tilde{\bX}_{it}'$ as rows

- FE estimator  $\xrightarrow{p}$ weighted average of individual effects
- In general
$$ \small
\mathrm{plim}_{N\to\infty} \hat{\bbeta}^{FE} \neq \E[\bbeta_i]
$$

#### Simulation Question of Today
 

::: {.rounded-box}

It is possible that "controlling for heterogeneity"  with FE estimators <span class="highlight">can lead to more bias</span>  than not doing anything about heterogeneity?

::: 

- This matters because FE estimators are used *a lot*
- Well-suited for simulations:
    - Theory hard due to $\hat{\bbeta}^{FE}$ depending on transforms and inverses of $\bX_{it}$ 
    - In simulations: can try to find a single example numerically


## Theory Essentials for Evaluating Causal Estimators {background="#00100F"}
 
#### Potential Outcomes

Same goes in panel or time series settings

#### Treatment Effects

#### Types of Causal Estimators


#### Settings for Studying Causal Estimators

Can study in settings where it's supposed to work


#### Metrics of Interest

There are three metrics you typically see when evaluating causal estimators:



- Bias
- Variance
- Sampling distribution

#### Metrics: Bias and Variance


#### Metrics: Distribution 



## Specifying the Simulations {background="#00100F"}
 
#### 

Causal process

Again: try to be as simple as possible

#### Model

#### Estimators Compared

- OLS: not doing anything at all about unobserved heterogeneity
- One-way random intercept/FE estimator

#### Goal

#### How Do You Find

start: it's something about $X_{it}$ and $\beta_i$ interacting, not about $U_{it}$, so don't need to pay much attention to $U_{it}$


####

Moent condition:
$$ 
\begin{aligned} \mathbb{E}[x_{it}(\alpha_i + \alpha_i x_{it}+ u_{it})] & = 0, \quad t=1, 2, \\ \mathbb{E}[(x_{i2}- x_{i1})(\alpha_i (x_{i2}- x_{i1})+ u_{it})] & \neq 0 . \end{aligned} 
$$


#### Covariate Distribution

- Can try simple normal distributions again
- Different distributions given different $\alpha_i$ --- some sort of implicit (self-)selection mechanism
$$  \small
\begin{aligned}
\begin{pmatrix} X_{i1} \\ X_{i2} \end{pmatrix}\Bigg| \alpha_i = + 1  & \sim N\left( \begin{pmatrix} \mu_{1+} \\ \mu_{2+} \end{pmatrix}, \begin{pmatrix} \sigma_{1+}^2 & \rho_+ \sigma_{1+} \sigma_{2+} \\ \rho_+ \sigma_{1+} \sigma_{2+} & \sigma_{2+}^2 \end{pmatrix} \right)  \\
\begin{pmatrix} X_{i1} \\ X_{i2} \end{pmatrix}\Bigg| \curl{\alpha_i = - 1}  & \sim N\left( \begin{pmatrix} \mu_{1-} \\ \mu_{2-} \end{pmatrix}, \begin{pmatrix} \sigma_{1-}^2 & \rho_- \sigma_{1-} \sigma_{2-} \\ \rho_- \sigma_{1-} \sigma
_{2-} & \sigma_{2-}^2 \end{pmatrix} \right)
\end{aligned}
$$

::: {.footer}

In some settings import to explicitly model selection into treatment

:::

## Simulation Implementation {background="#00100F"}

#### 

a


## Results {background="#00100F"}
 
####

## Recap and Conclusions {background="#00100F"}
 
#### Recap

<br>

In this lecture we 

- Reviewed  


#### References {.allowframebreaks visibility="uncounted"}

::: {#refs}
:::
